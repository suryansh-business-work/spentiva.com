---
// Cookie consent banner component with Accept/Decline functionality
---

<div
  id="cookie-consent"
  class="fixed bottom-0 left-0 right-0 z-50 transform translate-y-full transition-transform duration-500 ease-out"
  role="dialog"
  aria-labelledby="cookie-consent-title"
  aria-describedby="cookie-consent-description"
  aria-live="polite"
>
  <div class="bg-white border-t-2 border-primary-400 shadow-2xl">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl py-6">
      <div
        class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4"
      >
        <!-- Content -->
        <div class="flex-1">
          <h2
            id="cookie-consent-title"
            class="text-lg font-bold text-text-primary mb-2"
          >
            <i
              class="fas fa-cookie-bite text-primary-400 mr-2"
              aria-hidden="true"></i>
            We Value Your Privacy
          </h2>
          <p
            id="cookie-consent-description"
            class="text-sm text-text-secondary"
          >
            We use cookies to enhance your browsing experience, serve
            personalized content, and analyze our traffic. By clicking "Accept
            All", you consent to our use of cookies.
            <a
              href="/cookie-policy"
              class="text-primary-400 hover:text-primary-500 underline font-medium"
            >
              Learn more about our cookie policy
            </a>
          </p>
        </div>

        <!-- Actions -->
        <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
          <button
            id="cookie-decline"
            type="button"
            class="px-6 py-2.5 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gray-400 cursor-pointer"
            aria-label="Decline cookies"
          >
            Decline
          </button>
          <button
            id="cookie-accept"
            type="button"
            class="px-6 py-2.5 bg-primary-400 text-white font-semibold rounded-lg hover:bg-primary-500 transition-all duration-300 shadow-lg shadow-primary-400/25 focus:outline-none focus:ring-2 focus:ring-primary-400 cursor-pointer"
            aria-label="Accept all cookies"
          >
            Accept All
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const COOKIE_CONSENT_KEY = "spentiva_cookie_consent";
  const COOKIE_EXPIRY_DAYS = 365;

  // Cookie utilities
  function setCookie(name: string, value: string, days: number) {
    const date = new Date();
    date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
    const expires = `expires=${date.toUTCString()}`;
    document.cookie = `${name}=${value};${expires};path=/;SameSite=Lax`;
  }

  function getCookie(name: string): string | null {
    const nameEQ = name + "=";
    const ca = document.cookie.split(";");
    for (let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) === " ") c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  // Show/hide banner
  function showCookieBanner() {
    const banner = document.getElementById("cookie-consent");
    if (banner) {
      setTimeout(() => {
        banner.classList.remove("translate-y-full");
        banner.classList.add("translate-y-0");
      }, 1000);
    }
  }

  function hideCookieBanner() {
    const banner = document.getElementById("cookie-consent");
    if (banner) {
      banner.classList.remove("translate-y-0");
      banner.classList.add("translate-y-full");
      setTimeout(() => {
        banner.style.display = "none";
      }, 500);
    }
  }

  // Handle consent
  function handleConsent(accepted: boolean) {
    setCookie(
      COOKIE_CONSENT_KEY,
      accepted ? "accepted" : "declined",
      COOKIE_EXPIRY_DAYS,
    );
    hideCookieBanner();

    // If accepted, you can initialize analytics here
    if (accepted) {
      console.log("Cookies accepted - Analytics can be initialized");
      // Example: Initialize Google Analytics, etc.
    }
  }

  // Initialize
  document.addEventListener("DOMContentLoaded", () => {
    const consent = getCookie(COOKIE_CONSENT_KEY);

    if (!consent) {
      showCookieBanner();
    }

    // Event listeners
    const acceptBtn = document.getElementById("cookie-accept");
    const declineBtn = document.getElementById("cookie-decline");

    acceptBtn?.addEventListener("click", () => handleConsent(true));
    declineBtn?.addEventListener("click", () => handleConsent(false));
  });
</script>
